<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <docs>https://blogs.law.harvard.edu/tech/rss</docs>
    <title>Spice on Victor Toso</title>
    <link>http://victortoso.com/tags/spice/</link>
    <description>Recent content in Spice on Victor Toso</description>
    <ttl>1440</ttl>
    <generator>Hugo 0.55.0-DEV</generator>
    <language>en-us</language>
    <lastBuildDate>Mon, 06 Feb 2017 12:20:00 +0200</lastBuildDate>
    
      <atom:link href="http://victortoso.com/tags/spice/index.xml" rel="self" type="application/rss+xml" />
    
    
      <item>
        <title>New ways to remote desktops with GStreamer integration</title>
        <link>http://victortoso.com/talks/1701/</link>
        <pubDate>Mon, 06 Feb 2017 12:20:00 +0200</pubDate>
        <guid>http://victortoso.com/talks/1701/</guid>
        <description>Once again at DevConf CZ but now to talk about SPICE and its integration with GStreamer. Together with my friend and colleague Pavel Grunt we give a brief explanation about how SPICE works and then we focus on the image display and video streaming part of SPICE protocol while trying to clarify why streaming is so important to remote desktops.
Video Slides</description>
        <content:encoded><![CDATA[Once again at DevConf CZ but now to talk about SPICE and its integration with GStreamer. Together with my friend and colleague Pavel Grunt we give a brief explanation about how SPICE works and then we focus on the image display and video streaming part of SPICE protocol while trying to clarify why streaming is so important to remote desktops.
Video Slides
]]></content:encoded>
      </item>
    
      <item>
        <title>Playing with Desktop Integration</title>
        <link>http://victortoso.com/blog/1602/</link>
        <pubDate>Sat, 25 Jun 2016 15:10:00 +0200</pubDate>
        <guid>http://victortoso.com/blog/1602/</guid>
        <description>Thanks to a bug found in Spice&amp;rsquo;s drag and drop implementation, I was able to improve the integration of our guest agent (spice-vdagent) with the Desktop Session on Linux and Windows. I enjoyed the process to solve those problems so I thought a blog post could be interesting as well.
The problem If you use Spice you might enjoy the feature of copying files from your client machine to the guest by simply using the drag and drop feature.</description>
        <content:encoded><![CDATA[ Thanks to a bug found in Spice&amp;rsquo;s drag and drop implementation, I was able to improve the integration of our guest agent (spice-vdagent) with the Desktop Session on Linux and Windows. I enjoyed the process to solve those problems so I thought a blog post could be interesting as well.
The problem If you use Spice you might enjoy the feature of copying files from your client machine to the guest by simply using the drag and drop feature. It works pretty well and under the hood we are sending this data to spice-vdagent which copies it to your Download or Desktop folder.
The problem is that you could transfer files with drag and drop while your guest session was Locked (rhbz#1323623); even worse, it was also possible to transfer files when your guest were on Login Screen, when no user was logged in (rhbz#1328761).
In order to fix both issues, we need to ask (someone) about the Session state, the following questions &amp;quot;Is the session Locked?&amp;quot; and &amp;quot;Does this session belong to a user?&amp;quot;. Let&amp;rsquo;s see how we can do that.
Linux Guests In order to solve this in the best way possible, I did not want to make integration with specific Desktop Environment (DE) so, I started looking for a cross Desktop API.
My first try was around org.freedesktop.ScreenSaver interface which worked rather well. I had a few issues that I might be able to workaround but it did not seem right to request ScreenSaver the state of your user session.
So I looked at logind from systemd and there I could find a very promising &amp;lsquo;Lock&amp;rsquo; and &amp;lsquo;Unlock&amp;rsquo; signals! I checked with gdbus monitor if this was being used in my session with:
# get your session path with: gdbus call --system --dest org.freedesktop.login1 \ --object-path /org/freedesktop/login1 \ --method org.freedesktop.login1.Manager.ListSessions # monitor it gdbus monitor --system --dest org.freedesktop.login1 \ --object-path /org/freedesktop/login1/session/_31 # Lock an then Unlock your session with GNOME and see: /org/freedesktop/login1/session/_31: org.freedesktop.login1.Session.Unlock()  So, the Unlock signal was emitted but not the Lock signal. I thought it could be a bug so a filed #764773 to discuss it. It was not a bug and tracking the Lock and Unlock signals was not the best approach.
After some discussion with halfline we agreed that extending logind would make things easier. Lennart pointed that having a LockedHint property with SetLockedHint method would be a nice thing to have.
This would make rather simple to programs like spice-vdagent to query the Locked state of the Session.
The proposal was accepted and works well. One less bug to solve.
Back to the bad transfer over Login screen, that happens because we have a spice-vdagent running for GDM so we can do things like resizing the display correctly and as soon as possible.
The solution was rather simple here, all you need to do is to check your session class. We are only interested in a session that belongs to &amp;quot;User&amp;quot; and sd_session_get_class() can give you that.
That&amp;rsquo;s it for Linux guests. I also patched our console-kit integration but I don&amp;rsquo;t plan to comment on it. Take a look in this commit to check for the session class and this one to check if we are in a Locked session.
Many many thanks to halfline for his time and help, it was really fun.
Windows I wasn&amp;rsquo;t excited on the windows part so I postpone for some time but in the end, It was surprisingly easy. We only have one bug here due the design difference between our agents: the transfer while Guest is in Locked screen.
On Windows you can subscribe for session notifications and the event WTSRegisterSessionNotification has WTS_SESSION_LOCK and WTS_SESSION_UNLOCK types. Very handy. Minimum requirements say &amp;lsquo;Windows Vista&amp;rsquo; but it works on &amp;lsquo;Windows XP&amp;rsquo; as well. Super!
As we were already listening to sessions notifications, I only had to handle the lock/unlock events type (here).
Conclusion I&amp;rsquo;m naive. I thought I would have much more work with Desktop integration on Windows then on Linux! I&amp;rsquo;ll be more careful with my thoughts next time :)
Bugs bugs bugs.
]]></content:encoded>
      </item>
    
      <item>
        <title>Hello new life</title>
        <link>http://victortoso.com/blog/1408/</link>
        <pubDate>Sun, 26 Oct 2014 21:03:00 +0200</pubDate>
        <guid>http://victortoso.com/blog/1408/</guid>
        <description>Since the end of the Google Summer of Code 2014 so many things have happened that It is really hard to make a simple blog post about it&amp;hellip; but I must try :)
New job Well, along with the GSoC I&amp;rsquo;ve applied to a job at Red Hat and the process ended in August. Since October 15th I am part of the Spice team and I will be working at the Brno office in Czech Republic.</description>
        <content:encoded><![CDATA[ Since the end of the Google Summer of Code 2014 so many things have happened that It is really hard to make a simple blog post about it&amp;hellip; but I must try :)
New job Well, along with the GSoC I&amp;rsquo;ve applied to a job at Red Hat and the process ended in August. Since October 15th I am part of the Spice team and I will be working at the Brno office in Czech Republic.
I am really excited with the work and with the team. I am learning a lot already.
New City I have visited Brno at GUADEC 2013, lovely city. I feel safe here unlike Campinas in Brazil.
I have great expectations about living here and so do my wife after reading Christian&amp;rsquo;s blog post about leaving Brno.
Married Yay ;) Yes, biggest decision of my life.
We have been together for almost three years now and we were living together for almost one year which made this decision straightforward for me. Catielle is a wonderful person and I am really happy with our marriage. I feel that we are going to be very happy here in Brno.
Pending Well, I was quite a busy in the last two months but I still have a lot of things to do!
A few blog posts about GUADEC, GSoC and Grilo I want to move this Blog to Pelican :-) Finishing off a few things related to the last GSoC project, making it upstream! Writing a documentation for the lua-factory plugin :-)
That&amp;rsquo;s all for now! I will be back hacking and blogging now that things are getting calmer.
]]></content:encoded>
      </item>
    
  </channel>
</rss>
